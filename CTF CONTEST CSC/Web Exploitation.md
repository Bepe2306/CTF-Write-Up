# **Math AI**

In this challenge i was given a calculator website

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/615ab203-6595-484d-81e3-b12971996ce9)

i tried to do command injection like `ls` but nothing really worked. So then i tried to open the page source of this web to do scanning on the code of this website

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/f0c9cb72-74d5-49ba-96fb-c610d50b8b3f)

In the page source, there are several links for the backend of this website but there are only 2 interesting link.

The first link (`https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval`) connects to a mozilla website which is a clue to solve this challenge.
In this website i was given an explanation about `eval()` function which then i tried it on the math website

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/b91f0428-3909-479d-ab7d-b149ebd9f19a)

at first i was a bit confused what to do with this function, but then i tried to input a `eval('2 + 2') == eval('2 + 2')` function

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/9b82a411-7fc3-4c1e-82b1-a23b677b6f94)

It turns out returned a `true` condition which means that this calculator web is not just to count numbers, but can execute a JS command.

So then i entered the second link which gave me the JS script of the website

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/6b9be489-afba-48b7-9014-490ad4f15e51)

At first i tried to understand the JS and tried several eval function but nothing really works,
i tried to search `javascript injection eval` on google which then took me to this [link](https://vk9-sec.com/exploiting-javascript-eval-code-injection/).

When i analyze the website, it turned out to be the same exact website with this challenge which then i tried to analyze more further.

In the website, the author also tried to understand how the website works which then the author tried to execute JS function

`process.platform`
![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/dea90e8a-e60c-42c9-a492-f4f99677fb53)

`process.cwd()`
![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/0b342c30-7dc0-48c6-9b03-d676fd671c31)

From the test above, i could see that the JS function works just like the `eval()` function and from there we could also see the platform it is running (`linux`) and the current working directory(`/app`)

After that the author of the website tried another function which is `require('child_process').execSync('ls -l').toString()`.
Even the author gave several explanation about each part of the function:
1. `require('child_process')`: imports the child_process module which allow the machine to execute external commands
2. `execSync('ls -l')`: execute shell command which in this case execute `ls -l` to list the contents of current directory in long format
3. `toString()`: since the execSync result is in a buffer, `toString()` function will convert the buffer to a string

The author wants to execute this command(`require('child_process').execSync('ls -l').toString()`) because the author wants to see all list of contents from directory `/app` which might contains vulnerable data.
The author imports the `child_process` module to make `execSync` works since that command comes from that module and use `toString()` function to convert buffer to string.

When i execute the command, it gave me the flag of this challenge

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/fd0fc017-0ec4-49cb-a8ff-a419e94a69a8)

**FLAG:** `CSC{4Ku_4dal4h_fl49ny4_h4hihUh3hO}`


# **Environment As A Storage**

### **(NOTE: SOLVED AFTER THE CTF ENDED)**

In this challenge i was given a website looks like the picture below

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/ea40958e-4d7b-4548-ad00-d1352e4b0dfb)

At first i thought this might be some SQL injection website, but turns out it was not when i tried to input a random username and password

I input `1` as username and password which brought me to this page

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/a014ef04-60e4-485b-a1b9-5f5d376c1dc6)

from here, i suspect that this challenge is vulnerable to command injection. So then i tried to analyze the given source code from the probsetter.

When i analyze across the code, i found a `inject.php` script which list all of the ban command for this challenge

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/b45be6b1-2bac-4451-bd00-c7752acd4688)

From here, i know that this website must be vulnerable to command injection. I tried to inject a random command to intercept the request of this website

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/ec58bc89-46ae-46ae-8ef8-1b0bf25868b0)

From there, i brought it to repeater so that i can check how the website request method works. I tried to do a further analyze on the source and found this interesting part

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/cce8f00b-3af0-4a34-98c3-ba5debb24552)

By analyzing the code, i know that i need to use GET method in order to get the flag of this challenge. Since previously i tried to analyze the given source code, i found a `index.php` script which looks like the picture below

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/55d739f1-a43d-4f6c-8290-40872124a0f8)

from `index.php` i can see that the flag was move to another directory from the command `mv /flag.txt /tmp/flag_'.$randy.'.txt`. So then i need a way to print out the flag from that directory. 

At first i did some experiment on the request method of the website to help understand the way this website works and also avoiding the banned command from ban list

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/dd2328d4-4392-4ab9-a605-52f9e1d5e25a)

I tried to re-read the `inject.php` script again, from there i knew that if i use `POST` method, it seems that it will not work, so then i tried to use `GET` method and do some experiment again

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/9f3c1170-e3bf-4590-a534-c56636218099)

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/3f97f46a-f0e4-40e1-afd2-cdc5d4347522)

From there, i knew that `GET` method will work but i was confused on how to print out the flag since if i want to print out the flag, i need a way to manipulate `/` which was banned from the challenge. But sadly i did not have enough time to solved this challenge while the CTF running.

So after the CTF ended, i tried to do more research about how to manipulate `/` which then brought me to a `${HOME:0:1}`. This command is a slicing command which fits with the clue given by the author. Since most of directory starts with `/`, so when i put `0:1` it will act as a `/`

Short Explanation:

- string: /tmp/flag
- index:  12345
- ${HOME:index_start:index_finish}

So now i know how to manipulate `/`, i need to know the path to the flag. I tried to re-read the `index.php` again which then gave me a clue

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/cbc1a9d8-25a5-4d00-889e-e1053eeb2e4f)

From the given source code, i know that the directory will be: `/tmp/flag_'.$randy.'.txt`, but i need to find what the `$randy` is since it is a variable.

I tried to look at the code above, it turns out that `$randy` is a random number modulo by 10000 (`$randy = (rand()%10000)`). After that it gets package into `$cookie_const` variable (`$cookie_const = $randy . "=/" . $_POST['uname'] . "/" . $_POST['pw']`) which after that becomes `cookie` or `PHPSessionID` of the website encoded in base64(`setcookie("PHPSESSID", base64_encode($cookie_const))`). 

From here i can trace back to find the `$randy` in order to fill the path of the flag. I took the `PHPSessionID` from the website

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/9e47d420-2c82-40fa-9750-6db561c237a0)

bring it to (cyberchef)[] to decrypt it in order to get the random number(`$randy`)

![image](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/732119c1-8b21-4093-8de0-062b1df44900)

So then i input the command `tac${IFS}${HOME:0:1}tmp${HOME:0:1}flag_6854.txt` which gave me the flag of this challenge

![WhatsApp Image 2024-06-23 at 22 12 33_96960653](https://github.com/Bepe2306/CTF-Write-Up/assets/153899054/4260fb18-389f-4587-83c9-04e38c12080d)
**NOTE:** **i tried to redo the whole thing because previously my repater was laggy so i got different random number**

**FLAG:** `CSC{v3ry_54v3_3nv1r0nm3n74l_5t0r4g3}`
